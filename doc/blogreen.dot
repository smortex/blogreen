/*
 * Describe the global process of generating pages.
 */
digraph Blogreen {
    compound=true;
    fontname=inconsolata;
    fontsize=14;
    node[fontname=inconsolata, fontsize=10, margin=".2, .1", style=filled, fillcolor="#8ae234", color="#4e9a06"];
    edge[fontname=inconsolata, fontsize=10];

    node[shape=box]

    {
	rank=same;
	res		[label="resources.xml", shape=ellipse, fillcolor="#fcaf3e", color="#ce5c00", URL="http://blogreen.org/TR/Resources", tooltip="Resources Namespace"];
	map		[label="mapping.xml",   shape=ellipse, fillcolor="#fcaf3e", color="#ce5c00", URL="http://blogreen.org/TR/Mapping",   tooltip="Mapping Namespace"];
	config	[label="config.xml",    shape=ellipse, fillcolor="#fcaf3e", color="#ce5c00", URL="http://blogreen.org/TR/Config",    tooltip="Config Namespace"];
	views	[label="views.xsl",			fillcolor="#fcaf3e", color="#ce5c00"];
	srctmplxml		[label="template/${name}.xml", shape=invhouse, fillcolor="#fcaf3e", color="#ce5c00"];
    }

    subgraph clusterPagesMakefile {
	bpm		[label="build-pages-makefile.xsl"];
	pm		[label="Makefile.pages"];
    }

    bps		[label="build-pages-stylesheet.xsl"];

    subgraph clusterTemplatesMakefile {
	btm		[label="build-templates-makefile.xsl"];
	tm		[label="Makefile.templates"];
    }


    subgraph clusterTemplates {
	label = "Templates generator";
	shape=box;
	objtmplxml	[label="template/${name}.xml", shape=ellipse];
	objtmplxsl	[label="template/${name}.xsl"];

	at		[label="aggregate-template.xsl"];
	et		[label="expand-template.xsl"];

	config -> et [label="document()", style=dashed];

	at -> objtmplxml [color="#ef2929"];
	objtmplxml -> et;
	et -> objtmplxsl [color="#ef2929"];
    }
    srctmplxml -> at [label="document()", style=dashed];

    plugins		[label="${plugins}.xsl"];
    plugins -> objtmplxsl [label=import, style=dotted];

    subgraph clusterResources {
	ra		[label="resources-aggregator.xsl"];
	bra		[label="build-resources-aggregator.xsl"];
	ares		[label="aggregated-resources.xml", shape=ellipse];
	uexp		[label="uri-expander.xsl"];
	allres		[label="all-resources.xml", shape=ellipse];

	label = "Resources aggregator";
    }

    subgraph clusterPages {
	ps		[label="pages-stylesheets.xsl"];
	index		[label="${page}.html", shape=invhouse];

	subgraph clusterFo {
	    fp			[label="finish-pages.xsl"];
	    filters		[label="${filters}.xsl"];
	    fpp			[label="finish-page-pipeline.xsl"];

	    { fp; filters } -> fpp [label="import", style=dotted];

	    label = "Pages post-processing";
	}

	index -> fpp;

	label = "Pages generator";
    }

    bfpp [label="build-finish-page-pipeline.xsl"];
    config -> bfpp;

    tm -> at [lhead=clusterTemplates];

    map -> bra;
    res -> ra;
    res -> ra [label="document()", style=dashed];

    map -> bps;
    allres -> ps;
    {views; objtmplxsl} -> ps [label=include, style=dotted];

    map -> bpm;
    allres -> pm;

    map -> btm;

    pm -> index [lhead=clusterPages];

    rs	[label="robots-txt.xsl"];
    r	[label="robots.txt", shape=invhouse, fillcolor="#729fcf", color="#204a87"];
    ss	[label="sitemap.xsl"];
    s	[label="sitemap.xml", shape=invhouse, fillcolor="#729fcf", color="#204a87"];
    config -> rs [label="document()", style=dashed];
    allres -> rs;
    config -> ss [label="document()", style=dashed];
    allres -> ss;

    ares -> uexp;

    {
	edge[color="#ef2929"];
	bra -> ra -> ares;
	uexp -> allres;
	bps -> ps -> index;
	bpm -> pm;
	btm -> tm;
	fpp -> pindex;
	rs -> r;
	ss -> s;
	bfpp -> fpp;
    }

    {
	rank=same;
	s;
	r;
	pindex		[label="${page}.html", shape=invhouse, fillcolor="#729fcf", color="#204a87"];
    }

    fontsize=24;
    label="Blogreen build-process overview ($Id$)";
}
